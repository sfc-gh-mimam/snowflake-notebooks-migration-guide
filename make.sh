[{"text": "#!/bin/bash\n\n# Makefile-style script for common operations\n\nset -e\n\nCOLOR_RESET='\\033[0m'\nCOLOR_GREEN='\\033[0;32m'\nCOLOR_BLUE='\\033[0;34m'\nCOLOR_YELLOW='\\033[0;33m'\n\nfunction print_header() {\n    echo -e \"${COLOR_BLUE}===============================================${COLOR_RESET}\"\n    echo -e \"${COLOR_BLUE}$1${COLOR_RESET}\"\n    echo -e \"${COLOR_BLUE}===============================================${COLOR_RESET}\"\n}\n\nfunction print_success() {\n    echo -e \"${COLOR_GREEN}✓ $1${COLOR_RESET}\"\n}\n\nfunction print_info() {\n    echo -e \"${COLOR_YELLOW}➜ $1${COLOR_RESET}\"\n}\n\nfunction help() {\n    print_header \"Snowflake Notebooks Migration Guide - Commands\"\n    echo \"\"\n    echo \"Usage: ./make.sh [command]\"\n    echo \"\"\n    echo \"Commands:\"\n    echo \"  install         Install Python dependencies\"\n    echo \"  run             Run app locally with Streamlit\"\n    echo \"  build           Build Docker image\"\n    echo \"  run-docker      Run app in Docker container\"\n    echo \"  test            Run basic tests\"\n    echo \"  clean           Clean temporary files\"\n    echo \"  help            Show this help message\"\n    echo \"\"\n    echo \"SPCS Deployment:\"\n    echo \"  spcs-prep       Prepare for SPCS deployment\"\n    echo \"  spcs-build      Build and tag for Snowflake registry\"\n    echo \"\"\n}\n\nfunction install() {\n    print_header \"Installing Dependencies\"\n    pip install -r requirements.txt\n    print_success \"Dependencies installed\"\n}\n\nfunction run() {\n    print_header \"Starting Streamlit App\"\n    print_info \"App will be available at: http://localhost:8501\"\n    print_info \"Press Ctrl+C to stop\"\n    echo \"\"\n    streamlit run app/main.py\n}\n\nfunction build() {\n    print_header \"Building Docker Image\"\n    docker build -t migration-guide:latest .\n    print_success \"Docker image built: migration-guide:latest\"\n}\n\nfunction run_docker() {\n    print_header \"Running App in Docker\"\n    print_info \"Checking if container already exists...\"\n    docker rm -f migration-guide-local 2>/dev/null || true\n    \n    print_info \"Starting container...\"\n    print_info \"App will be available at: http://localhost:8501\"\n    print_info \"Press Ctrl+C to stop\"\n    echo \"\"\n    \n    docker run -p 8501:8501 \\\n        --name migration-guide-local \\\n        --rm \\\n        migration-guide:latest\n}\n\nfunction test() {\n    print_header \"Running Tests\"\n    \n    print_info \"Testing Python imports...\"\n    python3 -c \"import sys; sys.path.append('app'); from models import recommend_compute_pool; print('✓ Imports successful')\"\n    \n    print_info \"Testing recommendation engine...\"\n    python3 -c \"\nimport sys\nsys.path.append('app')\nfrom models import recommend_compute_pool, compare_costs, get_warehouse_by_code\n\n# Test recommendation\nresult = recommend_compute_pool('M', 'ML-heavy', 5, False)\nassert result['instance_family'] in ['CPU_X64_L', 'HIGHMEM_X64_M'], 'Unexpected recommendation'\nprint('✓ Recommendation engine working')\n\n# Test cost calculation\nwarehouse = get_warehouse_by_code('M')\ncomparison = compare_costs(warehouse, result, 8.0)\nassert comparison['monthly_savings'] is not None, 'Cost calculation failed'\nprint('✓ Cost calculator working')\n\nprint('✓ All tests passed!')\n\"\n    \n    print_success \"All tests passed\"\n}\n\nfunction clean() {\n    print_header \"Cleaning Temporary Files\"\n    \n    print_info \"Removing Python cache...\"\n    find . -type d -name \"__pycache__\" -exec rm -rf {} + 2>/dev/null || true\n    find . -type f -name \"*.pyc\" -delete 2>/dev/null || true\n    \n    print_info \"Removing Docker containers...\"\n    docker rm -f migration-guide-local 2>/dev/null || true\n    \n    print_success \"Cleanup complete\"\n}\n\nfunction spcs_prep() {\n    print_header \"Preparing for SPCS Deployment\"\n    \n    print_info \"Checking Docker...\"\n    if ! command -v docker &> /dev/null; then\n        echo \"Error: Docker not installed\"\n        exit 1\n    fi\n    print_success \"Docker found\"\n    \n    print_info \"Building image...\"\n    docker build -t migration-guide:latest .\n    print_success \"Image built\"\n    \n    echo \"\"\n    print_info \"Next steps:\"\n    echo \"1. Run setup.sql in Snowflake to create infrastructure\"\n    echo \"2. Get repository URL from Snowflake:\"\n    echo \"   SHOW IMAGE REPOSITORIES LIKE 'NOTEBOOKS_MIGRATION_REPO';\"\n    echo \"3. Set REPO_URL environment variable:\"\n    echo \"   export REPO_URL='<your-repo-url>'\"\n    echo \"4. Run: ./make.sh spcs-build\"\n    echo \"\"\n}\n\nfunction spcs_build() {\n    print_header \"Building for SPCS\"\n    \n    if [ -z \"$REPO_URL\" ]; then\n        echo \"Error: REPO_URL environment variable not set\"\n        echo \"Set it with: export REPO_URL='<your-snowflake-registry-url>'\"\n        exit 1\n    fi\n    \n    print_info \"Repository: $REPO_URL\"\n    \n    print_info \"Logging in to Snowflake registry...\"\n    docker login $REPO_URL\n    \n    print_info \"Tagging image...\"\n    docker tag migration-guide:latest $REPO_URL/migration-guide:latest\n    \n    print_info \"Pushing to Snowflake...\"\n    docker push $REPO_URL/migration-guide:latest\n    \n    print_success \"Image pushed to Snowflake registry\"\n    \n    echo \"\"\n    print_info \"Next steps:\"\n    echo \"1. Verify image in Snowflake:\"\n    echo \"   SHOW IMAGES IN IMAGE REPOSITORY NOTEBOOKS_MIGRATION_REPO;\"\n    echo \"2. Create service using setup.sql (Step 5)\"\n    echo \"3. Get endpoint:\"\n    echo \"   SHOW ENDPOINTS IN SERVICE MIGRATION_GUIDE_SERVICE;\"\n    echo \"\"\n}\n\n# Main command dispatcher\ncase \"$1\" in\n    install)\n        install\n        ;;\n    run)\n        run\n        ;;\n    build)\n        build\n        ;;\n    run-docker)\n        run_docker\n        ;;\n    test)\n        test\n        ;;\n    clean)\n        clean\n        ;;\n    spcs-prep)\n        spcs_prep\n        ;;\n    spcs-build)\n        spcs_build\n        ;;\n    help|--help|-h|\"\")\n        help\n        ;;\n    *)\n        echo \"Error: Unknown command '$1'\"\n        echo \"Run './make.sh help' for usage information\"\n        exit 1\n        ;;\nesac\n", "type": "text"}]